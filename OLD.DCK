FROM node:20-alpine

RUN apk add --no-cache ffmpeg python3 py3-pip gcompat \
    build-base autoconf automake

WORKDIR /app

COPY package*.json ./

RUN npm install 
RUN npm install --platform=linuxmusl --arch=arm64v8 sharp

COPY . .

EXPOSE 3000

CMD ["npm", "run", "start"]